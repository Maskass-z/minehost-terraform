<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>MineHost - Dashboard</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f9; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .flash { padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .danger { background: #f8d7da; color: #721c24; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
        button { cursor: pointer; padding: 5px 10px; border-radius: 4px; border: none; color: white;}
        .btn-stop { background: #e0a800; }
        .btn-start { background: #28a745; }
        .btn-del { background: #dc3545; }
        .btn-create { background: #007bff; padding: 10px 20px; font-size: 16px;}
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>Bonjour, {{ username }}!</h1>
        <a href="{{ url_for('logout') }}" style="color:red; text-decoration:none;">D√©connexion</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div style="background: #e9ecef; padding: 15px; border-radius: 5px;">
        <h3>Cr√©er un nouveau serveur</h3>
        <form method="POST" action="{{ url_for('create_server') }}">
            <input type="text" name="server_name" placeholder="Nom du serveur (ex: survie-1)" required pattern="[a-z0-9-]{3,20}" title="Lettres minuscules, chiffres et tirets uniquement.">
            
            <select name="version">
                <option value="1.21.8">1.21.8 (Latest)</option>
                <option value="1.20.1">1.20.1</option>
                <option value="1.19.4">1.19.4</option>
            </select>

            <select name="memory">
                <option value="512M">512 Mo (Eco)</option>
                <option value="1G">1 Go (Standard)</option>
                <option value="2G">2 Go (Pro)</option>
            </select>

            <button type="submit" class="btn-create">Cr√©er</button>
        </form>
    </div>

    <h2>Vos Serveurs Actifs</h2>
    {% if servers %}
        <table>
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Version</th>
                    <th>Adresse IP</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for name, port, version, status, mem in servers %}
                <tr>
                    <td><strong>{{ name }}</strong></td>
                    <td>{{ version }}</td>
                    <td>20.199.43.125:{{ port }}</td>
                    <td>
                        {% if status == 'running' %}
                            <span style="color:green">‚óè En ligne</span>
                        {% else %}
                            <span style="color:red">‚óè Arr√™t√©</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('show_logs', server_name=name) }}" style="text-decoration:none;">üìÑ Logs</a>
                        
                        {% if status == 'running' %}
                            <form action="{{ url_for('server_action', action_type='stop', server_name=name) }}" method="POST" style="display:inline;">
                                <button type="submit" class="btn-stop">Arr√™ter</button>
                            </form>
                        {% else %}
                            <form action="{{ url_for('server_action', action_type='start', server_name=name) }}" method="POST" style="display:inline;">
                                <button type="submit" class="btn-start">D√©marrer</button>
                            </form>
                        {% endif %}

                        <form action="{{ url_for('server_action', action_type='delete', server_name=name) }}" method="POST" style="display:inline;" onsubmit="return confirm('Vraiment supprimer {{ name }} ? Tout sera perdu.');">
                            <button type="submit" class="btn-del">Supprimer</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Aucun serveur. Cr√©ez-en un au-dessus !</p>
    {% endif %}
</div>

</body>
</html>